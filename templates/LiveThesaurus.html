<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js"></script>
		<link rel="stylesheet" href="../static/styles.css">

		<link rel="icon" href="../static/book.png">
		<link href="https://fonts.googleapis.com/css?family=Fira+Sans|Roboto+Mono|Sarabun" rel="stylesheet">

		<title style="font-family: "ira+Sans", Times, serif;">LiveThesaurus</title>
	</head>

	<body>
		<div class="parallax"></div>

		<div id="title">
			<h1>LiveThesaurus</h1>
			<a href="https://github.com/EdwardLu2018/LiveThesaurus" id="about" class="option">
				<img src="../static/about.png" alt="unavailable" height="17" width="17">
			</a>
		</div>

		<a href="#app" id="go-to-app">
			<div id="semi-circle">
				<img id="up-arrow" src="../static/up.png" alt="unavailable" height="53" width="50">
			</div>
		</a>

		<a name="app"></a>
		<div id="live-thesaurus">
			<div id="text-box">
				<textarea id="insert-text" rows="40" cols="82"></textarea>
			</div>

			<div id="info">
				<div id="selected-word-container" style="margin-top: 0px;">
					<div id="selected-word-title">Selected Word:</div>
					<div id="selected-word">{{word}}</div>
				</div>
				<div id="definition-container">
					<div id="definition-title">Definition:</div>
					<select id="definitions" style="text-align-last:center;">
						<option>none</option>
					</select>
				</div>
				<div id="term-container">
					<div id="term-title">Synonyms:</div>
					<select id="terms" size="25">
					  <option>none</option>
					</select>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			var word = null;
			var currDef = null;
			var defList = null;
			var synDict = null;

			$("#insert-text").mouseup(function () {
			  window.mySelection = this.value.substring(this.selectionStart, this.selectionEnd)

			  if (window.mySelection != "" && window.mySelection != null && window.mySelection.search(/\n/) == -1){
					//document.getElementById("selected-word").innerHTML = window.mySelection;
					$.ajax({
					    type: "POST",
					    url: "{{ url_for("getData") }}",
					    contentType: "application/json",
					    data: JSON.stringify({currWord:window.mySelection}),
					    dataType: "json",
					    success: function(response) {
					    	console.log(response.synList);
					    	if (response.currWord != 0){
					    		word = response.currWord;
					    		defList = response.defList;
					    		synDict = response.synList;

					        $("#selected-word").html("\"" + word + "\"");

					        $("#definitions").find("option").remove();
					        for (var i = 0; i < defList.length; i++){
					        	$("#definitions").append("<option>" + defList[i] + "</option>");
						    	}

						    	currDef = defList[0];

						    	$("#terms").find("option").remove();
									for (var i = 0; i < synDict[currDef].length; i++){
					    	    	$("#terms").append("<option>" + synDict[currDef][i].term + "</option>");
					    		}
						    }
						    else {
						    	word = null;
						    	currDef = null;
						    	defList = null;
					    		synDict = null;

					    		$("#selected-word").html("none");
					    		$("#definitions").append("<option>" + none + "</option>");
					    		$("#terms").append("<option>" + none + "</option>");
						    }
					    },
					    error: function(err) {
					      console.log(err);
					    }
					});
				}
			});

			$("#definitions").on('change', function () {
				currDef = $("#definitions").find(":selected").text();
				$("#terms").find("option").remove();
				for (var i = 0; i < synDict[currDef].length; i++){
    	    	$("#terms").append("<option>" + synDict[currDef][i].term + "</option>");
    		}
			});
		</script>
	</body>
</html>